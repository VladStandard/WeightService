@using Blazor.Heroicons.Outline
@using DeviceControl.Source.Features.ThemeSwitcher
@using DeviceControl.Source.Shared.Constants
@using WMBlazorOverlayScrollbars.WMBOS

<aside class="flex sticky top-0 flex-col bg-background w-full grow h-screen border-r">
  <div class="flex flex-col items-center shrink-0 justify-center pt-4 pb-2">
    <a class="flex gap-1 scale-[0.8]" href="@Urls.Home">
      <AdminLogo Class="size-7" />
      <h2 class="text-2xl pt-px tracking-[.25rem]">DMIN</h2>
      @if (!IsProduction)
      {
        <Badge Class="ml-1 mb-0.5" Type="BadgeType.Secondary">
          DEV
        </Badge>
      }
    </a>
  </div>
  <div class="size-full [&>.WMBOS]:h-full [&>.WMBOS>.os-theme-dark.os-host-transition>.os-scrollbar>.os-scrollbar-track>.os-scrollbar-handle]:!bg-primary/[.2] [&>.WMBOS>.os-theme-dark.os-host-transition>.os-scrollbar>.os-scrollbar-track>.os-scrollbar-handle:hover]:!bg-primary/[.3]">
    <BlazorOverlayScrollbars CssClass="h-full">
      <BlazorOverlayScrollbarsContent>
        <ul class="flex select-none w-full mb-2 flex-col px-3">
          @foreach (MenuSection menu in MenuSections)
          {
            <NavMenuItem
              Icon="@menu.Icon"
              Label="@menu.Label"
              Items="@menu.SubItems"
              RequiredClaim="@menu.RequiredClaim"
            />
          }
        </ul>
      </BlazorOverlayScrollbarsContent>
      <BlazorOverlayScrollbarsLoading><span class="hidden"/></BlazorOverlayScrollbarsLoading>
    </BlazorOverlayScrollbars>
  </div>
  <div class="h-16 px-4 flex items-center w-full shrink-0">
    <AuthorizeView>
      <Authorized>
        <div class="flex w-full items-center overflow-hidden justify-between">
          <div class="flex items-center gap-3 overflow-hidden w-full">
            <div class="size-10 p-2.5 rounded-full overflow-hidden flex items-center justify-center bg-secondary shrink-0">
              <UserIcon class="size-full" />
            </div>
            <div class="flex flex-col w-full overflow-hidden">
              <span class="text-sm truncate">@GetUserShortName()</span>
              <span class="text-xs text-muted-foreground truncate">@User.Identity?.Name</span>
            </div>
          </div>
          <form method="post" action="@($"{Urls.Authorization}/logout")" class="shrink-0">
            <Button Variant="ButtonVariantType.Ghost" Size="ButtonSizeType.Icon" Type="@ButtonType.Submit">
              <span class="sr-only">Logout</span>
              <ArrowLeftOnRectangleIcon class="size-5"/>
            </Button>
            <AntiforgeryToken />
          </form>
        </div>
      </Authorized>
      <NotAuthorized>
        <div class="flex w-full items-center justify-center">
          <a href="@($"{Urls.Authorization}/login")">
            <Button Variant="ButtonVariantType.Outline">
              Log in
            </Button>
          </a>
        </div>
      </NotAuthorized>
    </AuthorizeView>
    <ThemeSwitcher />
  </div>
</aside>
